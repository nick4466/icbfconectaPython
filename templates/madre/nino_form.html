{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ titulo_form|default:"Matricular Nuevo Ni√±o" }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0; font-family: 'Roboto', sans-serif; background-image: url("{% static 'img/fondito.jpg' %}");
      background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed;
    }

    .container { max-width: 900px; margin: 40px auto; background-color: rgba(255, 255, 255, 0.95); border-radius: 14px; padding: 30px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    h1 { text-align: center; font-size: 28px; color: #7a3eb1; margin-bottom: 25px; }
    .form-section { margin-bottom: 30px; }
    .form-section h2 { font-size: 20px; color: #5e3370; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e5d5f5; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .form-grid p { margin: 0; display: flex; flex-direction: column; }
    label { font-weight: bold; margin-bottom: 6px; color: #555; font-size: 14px; }
    input, select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-family: 'Roboto', sans-serif; font-size: 15px; }
    .required-star { color: #dc3545; margin-left: 4px; font-weight: bold; }
    .form-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
    .btn-guardar, .btn-volver {
      text-decoration: none; color: white; padding: 10px 25px; border-radius: 8px; font-weight: bold;
      border: none; cursor: pointer; font-size: 15px;
    }
    .btn-guardar { background-color: #9B59B6; }
    .btn-guardar:hover { background-color: #8e44ad; }
    .btn-volver { background-color: #6c757d; }
    .btn-volver:hover { background-color: #5a6268; }
    .alert-info { background-color: #e0f7fa; border-left: 5px solid #00bcd4; padding: 15px; margin-bottom: 25px; border-radius: 6px; }
    .error-message { color: red; font-weight: bold; margin-bottom: 15px; background-color: #f8d7da; padding: 10px; border-radius: 6px; border: 1px solid #f5c6cb; }
    .error-message ul { list-style: none; margin: 0; padding: 0; }
    .error-message li { color: #721c24; font-weight: normal; margin: 3px 0; }

    /* ========== ESTILOS PARA CHECKBOXES DE DISCAPACIDADES ========== */
    input[type="checkbox"] { 
      width: 18px; 
      height: 18px; 
      cursor: pointer;
      margin-right: 8px;
      accent-color: #9B59B6;
    }
    
    label input[type="checkbox"] {
      margin-right: 8px;
      vertical-align: middle;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 1024px) {
      .container {
        max-width: 95%;
        margin: 20px auto;
        padding: 24px;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .form-section h2 {
        font-size: 18px;
        margin-bottom: 12px;
      }

      .form-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }

      label {
        font-size: 13px;
        margin-bottom: 4px;
      }

      input,
      select {
        padding: 8px;
        font-size: 14px;
      }

      .form-actions {
        gap: 12px;
      }

      .btn-guardar,
      .btn-volver {
        padding: 10px 20px;
        font-size: 14px;
      }
    }

    @media (max-width: 768px) {
      .container {
        max-width: 95%;
        margin: 16px auto;
        padding: 16px;
        border-radius: 10px;
      }

      h1 {
        font-size: 20px;
        margin-bottom: 16px;
      }

      .form-section {
        margin-bottom: 20px;
      }

      .form-section h2 {
        font-size: 16px;
        margin-bottom: 10px;
        padding-bottom: 8px;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .form-grid p {
        margin-bottom: 12px;
      }

      label {
        font-size: 12px;
        margin-bottom: 4px;
        font-weight: 600;
        display: block;
      }

      input[type="text"],
      input[type="email"],
      input[type="date"],
      input[type="tel"],
      select {
        width: 100%;
        padding: 8px;
        font-size: 13px;
        border-radius: 4px;
      }

      .required-star {
        margin-left: 2px;
      }

      .form-actions {
        flex-direction: column-reverse;
        gap: 8px;
        margin-top: 16px;
      }

      .btn-guardar,
      .btn-volver {
        width: 100%;
        padding: 10px;
        font-size: 13px;
        border-radius: 4px;
      }

      .alert-info {
        padding: 12px;
        margin-bottom: 16px;
        font-size: 13px;
      }

      .error-message {
        padding: 8px;
        font-size: 12px;
        margin-bottom: 12px;
      }
    }

    @media (max-width: 480px) {
      .container {
        max-width: 100%;
        margin: 8px;
        padding: 12px;
        border-radius: 8px;
      }

      h1 {
        font-size: 16px;
        margin-bottom: 12px;
      }

      .form-section {
        margin-bottom: 16px;
      }

      .form-section h2 {
        font-size: 14px;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid #e5d5f5;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .form-grid p {
        margin-bottom: 10px;
      }

      label {
        font-size: 11px;
        margin-bottom: 3px;
      }

      input[type="text"],
      input[type="email"],
      input[type="date"],
      input[type="tel"],
      select {
        width: 100%;
        padding: 6px;
        font-size: 12px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #9B59B6;
        background-color: #f9f9f9;
      }

      .required-star {
        color: #dc3545;
        margin-left: 2px;
      }

      .form-actions {
        flex-direction: column-reverse;
        gap: 6px;
        margin-top: 12px;
      }

      .btn-guardar,
      .btn-volver {
        width: 100%;
        padding: 10px;
        font-size: 12px;
        border-radius: 4px;
        border: none;
      }

      .btn-guardar {
        background-color: #9B59B6;
        margin-bottom: 0;
      }

      .btn-volver {
        background-color: #6c757d;
      }

      .alert-info {
        padding: 10px;
        margin-bottom: 12px;
        font-size: 12px;
        border-left-width: 4px;
      }

      .error-message {
        padding: 8px;
        font-size: 11px;
        margin-bottom: 10px;
      }

      .error-message ul {
        margin: 6px 0 0 16px;
        padding: 0;
      }

      .error-message li {
        font-size: 11px;
        margin-bottom: 2px;
      }
    }
  </style>
</head>
<body>
  {% include 'madre/navbar_madre.html' %}

  <div class="container">
    <h1>
      {{ titulo_form|default:"Matricular Ni√±o" }} en Hogar: 
      {% if modo_edicion %}
        {{ nino.hogar.nombre_hogar }}
      {% else %}
        {{ hogar_madre.nombre_hogar }}
      {% endif %}
    </h1>

    {% if messages %}
      {% for message in messages %}
        <div class="error-message">{{ message }}</div>
      {% endfor %}
    {% endif %}

    {% if not modo_edicion %}
      <div class="alert-info">
        <p><strong>Nota importante:</strong> La identificaci√≥n (Documento) del padre ser√° usada como su nombre de usuario y contrase√±a inicial.</p>
      </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-section">
        <h2>Datos del Padre, Madre o Tutor</h2>
        <div class="form-grid">
          
          <!-- Tipo de Documento -->
          <p>
            <label for="{{ padre_form.tipo_documento.id_for_label }}">{{ padre_form.tipo_documento.label }}<span class="required-star">*</span></label>
            {{ padre_form.tipo_documento }}
            {% if padre_form.tipo_documento.errors %}<ul class="error-message">{% for error in padre_form.tipo_documento.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Documento -->
          <p>
            <label for="{{ padre_form.documento.id_for_label }}">{{ padre_form.documento.label }}<span class="required-star">*</span></label>
            {{ padre_form.documento }}
            {% if padre_form.documento.errors %}<ul class="error-message">{% for error in padre_form.documento.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Nombres -->
          <p>
            <label for="{{ padre_form.nombres.id_for_label }}">{{ padre_form.nombres.label }}<span class="required-star">*</span></label>
            {{ padre_form.nombres }}
            {% if padre_form.nombres.errors %}<ul class="error-message">{% for error in padre_form.nombres.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Apellidos -->
          <p>
            <label for="{{ padre_form.apellidos.id_for_label }}">{{ padre_form.apellidos.label }}<span class="required-star">*</span></label>
            {{ padre_form.apellidos }}
            {% if padre_form.apellidos.errors %}<ul class="error-message">{% for error in padre_form.apellidos.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Correo -->
          <p>
            <label for="{{ padre_form.correo.id_for_label }}">{{ padre_form.correo.label }}<span class="required-star">*</span></label>
            {{ padre_form.correo }}
            {% if padre_form.correo.errors %}<ul class="error-message">{% for error in padre_form.correo.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Tel√©fono -->
          <p>
            <label for="{{ padre_form.telefono.id_for_label }}">{{ padre_form.telefono.label }}<span class="required-star">*</span></label>
            {{ padre_form.telefono }}
            {% if padre_form.telefono.errors %}<ul class="error-message">{% for error in padre_form.telefono.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Departamento de Residencia -->
          <p>
            <label for="{{ padre_form.departamento_residencia.id_for_label }}">{{ padre_form.departamento_residencia.label }}<span class="required-star">*</span></label>
            {{ padre_form.departamento_residencia }}
            {% if padre_form.departamento_residencia.errors %}<ul class="error-message">{% for error in padre_form.departamento_residencia.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Ciudad/Municipio -->
          <p>
            <label for="{{ padre_form.ciudad_residencia.id_for_label }}">{{ padre_form.ciudad_residencia.label }}<span class="required-star">*</span></label>
            {{ padre_form.ciudad_residencia }}
            {% if padre_form.ciudad_residencia.errors %}<ul class="error-message">{% for error in padre_form.ciudad_residencia.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Localidad Bogot√° (si aplica) -->
          <p>
            <label for="{{ padre_form.localidad_bogota.id_for_label }}">{{ padre_form.localidad_bogota.label }}</label>
            {{ padre_form.localidad_bogota }}
            {% if padre_form.localidad_bogota.errors %}<ul class="error-message">{% for error in padre_form.localidad_bogota.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Direcci√≥n -->
          <p>
            <label for="{{ padre_form.direccion.id_for_label }}">{{ padre_form.direccion.label }}<span class="required-star">*</span></label>
            {{ padre_form.direccion }}
            {% if padre_form.direccion.errors %}<ul class="error-message">{% for error in padre_form.direccion.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Barrio -->
          <p>
            <label for="{{ padre_form.barrio.id_for_label }}">{{ padre_form.barrio.label }}</label>
            {{ padre_form.barrio }}
            {% if padre_form.barrio.errors %}<ul class="error-message">{% for error in padre_form.barrio.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Ocupaci√≥n -->
          <p>
            <label for="{{ padre_form.ocupacion.id_for_label }}">{{ padre_form.ocupacion.label }}<span class="required-star">*</span></label>
            {{ padre_form.ocupacion }}
            {% if padre_form.ocupacion.errors %}<ul class="error-message">{% for error in padre_form.ocupacion.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Estrato -->
          <p>
            <label for="{{ padre_form.estrato.id_for_label }}">{{ padre_form.estrato.label }}</label>
            {{ padre_form.estrato }}
            {% if padre_form.estrato.errors %}<ul class="error-message">{% for error in padre_form.estrato.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Nombre Contacto de Emergencia -->
          <p>
            <label for="{{ padre_form.nombre_contacto_emergencia.id_for_label }}">{{ padre_form.nombre_contacto_emergencia.label }}</label>
            {{ padre_form.nombre_contacto_emergencia }}
            {% if padre_form.nombre_contacto_emergencia.errors %}<ul class="error-message">{% for error in padre_form.nombre_contacto_emergencia.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Tel√©fono Contacto de Emergencia -->
          <p>
            <label for="{{ padre_form.telefono_contacto_emergencia.id_for_label }}">{{ padre_form.telefono_contacto_emergencia.label }}</label>
            {{ padre_form.telefono_contacto_emergencia }}
            {% if padre_form.telefono_contacto_emergencia.errors %}<ul class="error-message">{% for error in padre_form.telefono_contacto_emergencia.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Documento de Identidad -->
          <p>
            <label for="{{ padre_form.documento_identidad_img.id_for_label }}">{{ padre_form.documento_identidad_img.label }}</label>
            {{ padre_form.documento_identidad_img }}
            {% if padre_form.documento_identidad_img.errors %}<ul class="error-message">{% for error in padre_form.documento_identidad_img.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Clasificaci√≥n SISBEN -->
          <p>
            <label for="{{ padre_form.clasificacion_sisben.id_for_label }}">{{ padre_form.clasificacion_sisben.label }}</label>
            {{ padre_form.clasificacion_sisben }}
            {% if padre_form.clasificacion_sisben.errors %}<ul class="error-message">{% for error in padre_form.clasificacion_sisben.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Situaci√≥n Econ√≥mica del Hogar -->
          <p style="grid-column: 1 / -1;">
            <label for="{{ padre_form.situacion_economica_hogar.id_for_label }}">{{ padre_form.situacion_economica_hogar.label }}</label>
            {{ padre_form.situacion_economica_hogar }}
            {% if padre_form.situacion_economica_hogar.errors %}<ul class="error-message">{% for error in padre_form.situacion_economica_hogar.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

        </div>
      </div>
      <div class="form-section">
        <h2>Datos del Ni√±o</h2>
        <div class="form-grid">
          
          <!-- Nombres del Ni√±o -->
          <p>
            <label for="{{ nino_form.nombres.id_for_label }}">{{ nino_form.nombres.label }}<span class="required-star">*</span></label>
            {{ nino_form.nombres }}
            {% if nino_form.nombres.errors %}<ul class="error-message">{% for error in nino_form.nombres.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Apellidos del Ni√±o -->
          <p>
            <label for="{{ nino_form.apellidos.id_for_label }}">{{ nino_form.apellidos.label }}<span class="required-star">*</span></label>
            {{ nino_form.apellidos }}
            {% if nino_form.apellidos.errors %}<ul class="error-message">{% for error in nino_form.apellidos.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Tipo de Documento del Ni√±o -->
          <p>
            <label for="{{ nino_form.tipo_documento.id_for_label }}">{{ nino_form.tipo_documento.label }}<span class="required-star">*</span></label>
            {{ nino_form.tipo_documento }}
            {% if nino_form.tipo_documento.errors %}<ul class="error-message">{% for error in nino_form.tipo_documento.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Documento del Ni√±o -->
          <p>
            <label for="{{ nino_form.documento.id_for_label }}">{{ nino_form.documento.label }}</label>
            {{ nino_form.documento }}
            {% if nino_form.documento.errors %}<ul class="error-message">{% for error in nino_form.documento.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Fecha de Nacimiento -->
          <p>
            <label for="{{ nino_form.fecha_nacimiento.id_for_label }}">{{ nino_form.fecha_nacimiento.label }}<span class="required-star">*</span></label>
            {{ nino_form.fecha_nacimiento }}
            {% if nino_form.fecha_nacimiento.errors %}<ul class="error-message">{% for error in nino_form.fecha_nacimiento.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- G√©nero -->
          <p>
            <label for="{{ nino_form.genero.id_for_label }}">{{ nino_form.genero.label }}<span class="required-star">*</span></label>
            {{ nino_form.genero }}
            {% if nino_form.genero.errors %}<ul class="error-message">{% for error in nino_form.genero.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Nacionalidad -->
          <p>
            <label for="{{ nino_form.nacionalidad.id_for_label }}">{{ nino_form.nacionalidad.label }}<span class="required-star">*</span></label>
            {{ nino_form.nacionalidad }}
            {% if nino_form.nacionalidad.errors %}<ul class="error-message">{% for error in nino_form.nacionalidad.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Otro Pa√≠s -->
          <p>
            <label for="{{ nino_form.otro_pais.id_for_label }}">{{ nino_form.otro_pais.label }}</label>
            {{ nino_form.otro_pais }}
            {% if nino_form.otro_pais.errors %}<ul class="error-message">{% for error in nino_form.otro_pais.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Tipo de Sangre -->
          <p>
            <label for="{{ nino_form.tipo_sangre.id_for_label }}">{{ nino_form.tipo_sangre.label }}</label>
            {{ nino_form.tipo_sangre }}
            {% if nino_form.tipo_sangre.errors %}<ul class="error-message">{% for error in nino_form.tipo_sangre.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Parentesco -->
          <p>
            <label for="{{ nino_form.parentesco.id_for_label }}">{{ nino_form.parentesco.label }}<span class="required-star">*</span></label>
            {{ nino_form.parentesco }}
            {% if nino_form.parentesco.errors %}<ul class="error-message">{% for error in nino_form.parentesco.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- ¬øTiene discapacidad? -->
          <p>
            <label for="{{ nino_form.tiene_discapacidad.id_for_label }}">
              <input type="checkbox" id="{{ nino_form.tiene_discapacidad.id_for_label }}" name="{{ nino_form.tiene_discapacidad.html_name }}">
              {{ nino_form.tiene_discapacidad.label }}
            </label>
            {% if nino_form.tiene_discapacidad.errors %}<ul class="error-message">{% for error in nino_form.tiene_discapacidad.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- SECCI√ìN DE DISCAPACIDADES (Solo se muestra si marc√≥ el checkbox) -->
          <div id="discapacidad-section" style="display: none; grid-column: 1 / -1; background-color: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #7a3eb1; margin: 10px 0;">
            
            <h3 style="color: #7a3eb1; margin-top: 0; margin-bottom: 15px;">Informaci√≥n de Discapacidad</h3>
            
            <!-- Tipos de Discapacidad -->
            {% if nino_form.tipos_discapacidad %}
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #555;">{{ nino_form.tipos_discapacidad.label }}</label>
              <div style="padding: 15px; background-color: white; border: 1px solid #e0e0e0; border-radius: 6px;">
                {{ nino_form.tipos_discapacidad }}
              </div>
              {% if nino_form.tipos_discapacidad.errors %}<ul class="error-message">{% for error in nino_form.tipos_discapacidad.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
            </div>
            {% endif %}

            <!-- Otra Discapacidad -->
            <div>
              <label for="{{ nino_form.otra_discapacidad.id_for_label }}" style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">{{ nino_form.otra_discapacidad.label }}</label>
              <input type="text" id="{{ nino_form.otra_discapacidad.id_for_label }}" name="{{ nino_form.otra_discapacidad.html_name }}" value="{{ nino_form.otra_discapacidad.value|default:'' }}" placeholder="Especifique la discapacidad..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-family: 'Roboto', sans-serif; font-size: 15px;">
              {% if nino_form.otra_discapacidad.errors %}<ul class="error-message">{% for error in nino_form.otra_discapacidad.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
            </div>
          </div>

          <!-- Foto del Ni√±o -->
          <p>
            <label for="{{ nino_form.foto.id_for_label }}">{{ nino_form.foto.label }}</label>
            {{ nino_form.foto }}
            {% if nino_form.foto.errors %}<ul class="error-message">{% for error in nino_form.foto.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Carn√© de Vacunaci√≥n -->
          <p>
            <label for="{{ nino_form.carnet_vacunacion.id_for_label }}">{{ nino_form.carnet_vacunacion.label }}</label>
            {{ nino_form.carnet_vacunacion }}
            {% if nino_form.carnet_vacunacion.errors %}<ul class="error-message">{% for error in nino_form.carnet_vacunacion.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Certificado EPS -->
          <p>
            <label for="{{ nino_form.certificado_eps.id_for_label }}">{{ nino_form.certificado_eps.label }}</label>
            {{ nino_form.certificado_eps }}
            {% if nino_form.certificado_eps.errors %}<ul class="error-message">{% for error in nino_form.certificado_eps.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

          <!-- Registro Civil -->
          <p>
            <label for="{{ nino_form.registro_civil_img.id_for_label }}">{{ nino_form.registro_civil_img.label }}</label>
            {{ nino_form.registro_civil_img }}
            {% if nino_form.registro_civil_img.errors %}<ul class="error-message">{% for error in nino_form.registro_civil_img.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
          </p>

        </div>
      </div>
      <div class="form-actions">
        <a href="{% url 'listar_ninos' %}" class="btn-volver">Volver</a>
        <button type="submit" class="btn-guardar">
          {% if modo_edicion %}Guardar Cambios{% else %}Matricular Ni√±o{% endif %}
        </button>
      </div>
    </form>
  </div>

  <script>
    // ========== 1. CARGAR MUNICIPIOS DIN√ÅMICAMENTE ==========
    document.addEventListener('DOMContentLoaded', function() {
      const departamentoSelect = document.getElementById('id_padre-departamento_residencia');
      const municipioSelect = document.getElementById('id_padre-ciudad_residencia');
      
      if (departamentoSelect && municipioSelect) {
        // Cargar municipios cuando cambia el departamento
        departamentoSelect.addEventListener('change', function() {
          const departamentoId = this.value;
          
          if (!departamentoId) {
            municipioSelect.innerHTML = '<option value="">-- Seleccione una Ciudad --</option>';
            return;
          }
          
          // Llamar endpoint AJAX
          fetch(`{% url 'ajax_cargar_municipios' %}?departamento_id=${departamentoId}`)
            .then(response => response.json())
            .then(data => {
              // Limpiar opciones previas
              municipioSelect.innerHTML = '<option value="">-- Seleccione una Ciudad --</option>';
              
              // Agregar nuevas opciones
              if (Array.isArray(data)) {
                data.forEach(municipio => {
                  const option = document.createElement('option');
                  option.value = municipio.id;
                  option.textContent = municipio.nombre;
                  municipioSelect.appendChild(option);
                });
              }
            })
            .catch(error => console.error('Error cargando municipios:', error));
        });
        
        // Si ya hay departamento seleccionado (edici√≥n), cargar municipios autom√°ticamente
        if (departamentoSelect.value) {
          departamentoSelect.dispatchEvent(new Event('change'));
        }
      }
    });

    // ========== 2. PREVIEW DE ARCHIVOS (IM√ÅGENES) EN EL FORMULARIO ==========
    document.addEventListener('DOMContentLoaded', function() {
      const fileInputs = document.querySelectorAll('input[type="file"]');
      
      fileInputs.forEach(input => {
        input.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(event) {
              // Eliminar preview anterior si existe
              let existingPreview = input.parentElement.querySelector('.file-preview');
              if (existingPreview) {
                existingPreview.remove();
              }
              
              // Crear contenedor de preview
              const previewDiv = document.createElement('div');
              previewDiv.className = 'file-preview';
              previewDiv.style.cssText = `
                margin-top: 10px;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background-color: #f9f9f9;
              `;
              
              const img = document.createElement('img');
              img.src = event.target.result;
              img.style.cssText = `
                max-width: 100%;
                max-height: 200px;
                border-radius: 4px;
              `;
              
              const fileName = document.createElement('p');
              fileName.textContent = `üìÅ ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
              fileName.style.cssText = `
                margin: 10px 0 0 0;
                font-size: 12px;
                color: #666;
              `;
              
              previewDiv.appendChild(img);
              previewDiv.appendChild(fileName);
              input.parentElement.appendChild(previewDiv);
            };
            reader.readAsDataURL(file);
          } else if (file) {
            // Para archivos no-imagen (PDF, etc), mostrar solo informaci√≥n
            let existingPreview = input.parentElement.querySelector('.file-preview');
            if (existingPreview) {
              existingPreview.remove();
            }
            
            const previewDiv = document.createElement('div');
            previewDiv.className = 'file-preview';
            previewDiv.style.cssText = `
              margin-top: 10px;
              padding: 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              background-color: #f9f9f9;
            `;
            
            const fileName = document.createElement('p');
            fileName.textContent = `üìÑ ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            fileName.style.cssText = `
              margin: 0;
              font-size: 12px;
              color: #666;
            `;
            
            previewDiv.appendChild(fileName);
            input.parentElement.appendChild(previewDiv);
          }
        });
      });
    });

    // ========== 3. VALIDACI√ìN DE FECHA DE NACIMIENTO (1-5 a√±os) ==========
    document.addEventListener('DOMContentLoaded', function() {
      const fechaNacimientoInput = document.getElementById('id_nino-fecha_nacimiento');
      
      if (fechaNacimientoInput) {
        fechaNacimientoInput.addEventListener('change', function() {
          const fechaSeleccionada = new Date(this.value);
          const hoy = new Date();
          
          let edad = hoy.getFullYear() - fechaSeleccionada.getFullYear();
          const mes = hoy.getMonth() - fechaSeleccionada.getMonth();
          
          if (mes < 0 || (mes === 0 && hoy.getDate() < fechaSeleccionada.getDate())) {
            edad--;
          }
          
          // Mostrar validaci√≥n
          let mensaje = '';
          if (edad < 1) {
            mensaje = '‚ö†Ô∏è El ni√±o es menor de 1 a√±o (edad m√≠nima requerida).';
            this.style.borderColor = '#dc3545';
          } else if (edad > 5) {
            mensaje = '‚ö†Ô∏è El ni√±o es mayor de 5 a√±os (edad m√°xima permitida).';
            this.style.borderColor = '#dc3545';
          } else {
            mensaje = `‚úì Edad v√°lida: ${edad} a√±os`;
            this.style.borderColor = '#28a745';
          }
          
          // Mostrar o actualizar el mensaje
          let validationMsg = this.parentElement.querySelector('.validation-message');
          if (!validationMsg) {
            validationMsg = document.createElement('small');
            validationMsg.className = 'validation-message';
            validationMsg.style.cssText = `
              display: block;
              margin-top: 5px;
              font-weight: bold;
            `;
            this.parentElement.appendChild(validationMsg);
          }
          
          validationMsg.textContent = mensaje;
          validationMsg.style.color = edad < 1 || edad > 5 ? '#dc3545' : '#28a745';
        });
      }
    });

    // ========== 4. VALIDACI√ìN DOCUMENTO DEL NI√ëO EN TIEMPO REAL ==========
    document.addEventListener('DOMContentLoaded', function() {
      const documentoNinoInput = document.getElementById('id_nino-documento');
      
      if (documentoNinoInput) {
        let validateTimer;
        
        documentoNinoInput.addEventListener('input', function() {
          clearTimeout(validateTimer);
          const documento = this.value.trim();
          
          if (!documento || documento.length < 5) {
            // Limpiar mensajes si el campo est√° vac√≠o
            let validationMsg = this.parentElement.querySelector('.validation-message');
            if (validationMsg) validationMsg.remove();
            this.style.borderColor = '#ccc';
            return;
          }
          
          // Debounce: esperar 500ms sin cambios antes de validar
          validateTimer = setTimeout(() => {
            fetch(`{% url 'validar_documento_nino' %}?documento=${encodeURIComponent(documento)}`)
              .then(response => response.json())
              .then(data => {
                let validationMsg = documentoNinoInput.parentElement.querySelector('.validation-message');
                
                if (!validationMsg) {
                  validationMsg = document.createElement('small');
                  validationMsg.className = 'validation-message';
                  validationMsg.style.cssText = `
                    display: block;
                    margin-top: 5px;
                    font-weight: bold;
                  `;
                  documentoNinoInput.parentElement.appendChild(validationMsg);
                }
                
                validationMsg.textContent = data.mensaje;
                
                if (data.valido) {
                  validationMsg.style.color = '#28a745';
                  documentoNinoInput.style.borderColor = '#28a745';
                } else {
                  validationMsg.style.color = '#dc3545';
                  documentoNinoInput.style.borderColor = '#dc3545';
                }
              })
              .catch(error => console.error('Error validando documento:', error));
          }, 500);
        });
      }
    });

    // ========== 5. VALIDACI√ìN CORREO DEL PADRE EN TIEMPO REAL ==========
    document.addEventListener('DOMContentLoaded', function() {
      const correoInput = document.getElementById('id_padre-correo');
      
      if (correoInput) {
        let validateTimer;
        
        correoInput.addEventListener('input', function() {
          clearTimeout(validateTimer);
          const correo = this.value.trim();
          
          if (!correo || !correo.includes('@')) {
            // Limpiar mensajes si el campo est√° vac√≠o o sin @
            let validationMsg = this.parentElement.querySelector('.validation-message');
            if (validationMsg) validationMsg.remove();
            this.style.borderColor = '#ccc';
            return;
          }
          
          // Debounce: esperar 500ms sin cambios antes de validar
          validateTimer = setTimeout(() => {
            fetch(`{% url 'validar_correo_padre' %}?correo=${encodeURIComponent(correo)}`)
              .then(response => response.json())
              .then(data => {
                let validationMsg = correoInput.parentElement.querySelector('.validation-message');
                
                if (!validationMsg) {
                  validationMsg = document.createElement('small');
                  validationMsg.className = 'validation-message';
                  validationMsg.style.cssText = `
                    display: block;
                    margin-top: 5px;
                    font-weight: bold;
                  `;
                  correoInput.parentElement.appendChild(validationMsg);
                }
                
                validationMsg.textContent = data.mensaje;
                
                if (data.valido) {
                  validationMsg.style.color = '#28a745';
                  correoInput.style.borderColor = '#28a745';
                } else {
                  validationMsg.style.color = '#dc3545';
                  correoInput.style.borderColor = '#dc3545';
                }
              })
              .catch(error => console.error('Error validando correo:', error));
          }, 500);
        });
      }
    });

    // ========== 6. MOSTRAR/OCULTAR SECCI√ìN DE DISCAPACIDADES ==========
    document.addEventListener('DOMContentLoaded', function() {
      const tieneDicapacidadCheckbox = document.getElementById('id_nino-tiene_discapacidad');
      const discapacidadSection = document.getElementById('discapacidad-section');
      
      if (tieneDicapacidadCheckbox && discapacidadSection) {
        // Mostrar/ocultar secci√≥n cuando cambia el checkbox
        tieneDicapacidadCheckbox.addEventListener('change', function() {
          if (this.checked) {
            discapacidadSection.style.display = 'block';
          } else {
            discapacidadSection.style.display = 'none';
          }
        });
        
        // Si ya est√° marcado (edici√≥n), mostrar la secci√≥n
        if (tieneDicapacidadCheckbox.checked) {
          discapacidadSection.style.display = 'block';
        }
      }
    });
  </script>

  {% if not modo_edicion %}
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const docInput = document.getElementById('id_padre-documento');
    if (docInput) {
      docInput.addEventListener('blur', function() {
        const documento = this.value;
        if (documento.length > 5) { // Un chequeo simple
          fetch(`{% url 'buscar_padre' %}?documento=${documento}`)
            .then(response => response.json())
            .then(data => {
              if (data.encontrado) {
                // Rellenar campos y hacerlos de solo lectura
                document.getElementById('id_padre-nombres').value = data.nombres;
                document.getElementById('id_padre-apellidos').value = data.apellidos;
                document.getElementById('id_padre-correo').value = data.correo;
                document.getElementById('id_padre-telefono').value = data.telefono;
                document.getElementById('id_padre-direccion').value = data.direccion;
                document.getElementById('id_padre-ocupacion').value = data.ocupacion;

                // Opcional: deshabilitar campos para evitar edici√≥n
                document.getElementById('id_padre-nombres').readOnly = true;
                document.getElementById('id_padre-apellidos').readOnly = true;
                document.getElementById('id_padre-correo').readOnly = true;
              } else {
                // Limpiar y habilitar campos si no se encuentra el padre
                document.getElementById('id_padre-nombres').value = '';
                document.getElementById('id_padre-apellidos').value = '';
                document.getElementById('id_padre-correo').value = '';
                
                document.getElementById('id_padre-nombres').readOnly = false;
                document.getElementById('id_padre-apellidos').readOnly = false;
                document.getElementById('id_padre-correo').readOnly = false;
              }
            });
        }
      });
    }
  });
  </script>
  {% endif %}

  <script>
    // A√±ade un asterisco a los campos obligatorios del formulario de Django
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('input[required], select[required], textarea[required]').forEach(field => {
        const label = document.querySelector(`label[for="${field.id}"]`);
        if (label && !label.querySelector('.required-star')) {
          const star = document.createElement('span');
          star.className = 'required-star';
          star.textContent = '*';
          label.appendChild(star);
        }
      });
    });
  </script>
</body>
</html>
