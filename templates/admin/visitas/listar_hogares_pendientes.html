{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hogares Pendientes de Visita</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Poppins",sans-serif;background:#f3f6fa;color:#333;min-height:100vh}
    
    /* Sidebar Styles - matching admin_sidebar.html */
    .sidebar { position: fixed; left: 0; top: 0; height: 100vh; width: 260px; background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%); padding: 20px 0; overflow-y: auto; z-index: 1000; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
    .sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
    .sidebar-logo { display: flex; align-items: center; gap: 12px; color: white; text-decoration: none; }
    .sidebar-logo img { width: 45px; height: 45px; border-radius: 8px; }
    .sidebar-logo-text h2 { font-size: 18px; font-weight: 700; }
    .sidebar-logo-text p { font-size: 12px; opacity: 0.8; }
    .sidebar-nav { padding: 0 10px; }
    .nav-item { margin-bottom: 4px; }
    .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: rgba(255,255,255,0.9); text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-weight: 500; font-size: 14px; }
    .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-link.active { background: rgba(255,255,255,0.2); color: white; }
    .nav-link i { width: 20px; font-size: 18px; }
    
    .main{margin-left:260px;padding:40px;max-width:1400px;width:100%}
    .main header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
    .main header h1{font-size:28px;color:#004080;font-weight:700}
    .stats-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
    .stat-card{background:white;padding:20px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);display:flex;align-items:center;gap:15px}
    .stat-card .icon{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px}
    .stat-card.pendiente .icon{background:#fff3cd;color:#856404}
    .stat-card.agendada .icon{background:#d1ecf1;color:#0c5460}
    .stat-card.evaluacion .icon{background:#d4edda;color:#155724}
    .stat-card .info h3{font-size:28px;color:#004080;margin:0}
    .stat-card .info p{font-size:14px;color:#666;margin:0}
    .table-container{background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);overflow:hidden}
    table{width:100%;border-collapse:collapse}
    thead{background:linear-gradient(90deg,#004080,#007bff);color:white}
    thead th{padding:15px;text-align:left;font-weight:600}
    tbody tr{border-bottom:1px solid #e0e0e0;transition:background .2s}
    tbody tr:hover{background:#f8f9fa}
    tbody td{padding:12px 15px}
    .badge{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600}
    .badge.pendiente{background:#fff3cd;color:#856404}
    .badge.agendada{background:#d1ecf1;color:#0c5460}
    .badge.evaluacion{background:#d4edda;color:#155724}
    .btn{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:8px;transition:all .2s}
    .btn-primary{background:#007bff;color:white}
    .btn-primary:hover{background:#0056b3}
    .btn-success{background:#28a745;color:white}
    .btn-success:hover{background:#218838}
    .pagination{display:flex;justify-content:center;gap:10px;margin-top:20px;padding:20px}
    .pagination a,.pagination span{padding:8px 12px;background:white;border-radius:6px;text-decoration:none;color:#004080;border:1px solid #ddd}
    .pagination .current{background:#004080;color:white;border-color:#004080}
  </style>
</head>
<body>
  {% include 'admin/components/admin_sidebar.html' %}

  <div class="main">
    <header>
      <h1><i class="fas fa-home"></i> Hogares Pendientes de Visita Técnica</h1>
    </header>

    <!-- Tarjetas de Estadísticas -->
    <div class="stats-cards">
      <div class="stat-card pendiente">
        <div class="icon"><i class="fas fa-hourglass-half"></i></div>
        <div class="info">
          <h3>{{ total_pendientes }}</h3>
          <p>Pendientes de Agendar</p>
        </div>
      </div>
      <div class="stat-card agendada">
        <div class="icon"><i class="fas fa-calendar-check"></i></div>
        <div class="info">
          <h3>{{ total_agendadas }}</h3>
          <p>Visitas Agendadas</p>
        </div>
      </div>
      <div class="stat-card evaluacion">
        <div class="icon"><i class="fas fa-clipboard-list"></i></div>
        <div class="info">
          <h3>{{ total_evaluacion }}</h3>
          <p>En Evaluación</p>
        </div>
      </div>
    </div>

    <!-- Tabla de Hogares -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Hogar</th>
            <th>Agente Educativo</th>
            <th>Ubicación</th>
            <th>Estado</th>
            <th>Fecha Registro</th>
            <th>Visita</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for hogar in page_obj %}
          <tr>
            <td><strong>{{ hogar.nombre_hogar }}</strong></td>
            <td>{{ hogar.madre.usuario.nombres }} {{ hogar.madre.usuario.apellidos }}</td>
            <td>
              {{ hogar.ciudad.nombre }}, {{ hogar.regional.nombre }}
              {% if hogar.localidad_bogota %}
                <br><small style="color:#666;">{{ hogar.localidad_bogota.nombre }}</small>
              {% endif %}
            </td>
            <td>
              {% if hogar.estado == 'pendiente_visita' %}
                <span class="badge pendiente">Pendiente</span>
              {% elif hogar.estado == 'visita_agendada' %}
                <span class="badge agendada">Agendada</span>
              {% elif hogar.estado == 'en_evaluacion' %}
                <span class="badge evaluacion">En Evaluación</span>
              {% endif %}
            </td>
            <td>{{ hogar.fecha_registro|date:"d/m/Y" }}</td>
            <td>
              {% with hogar.visitas_tecnicas.first as ultima_visita %}
                {% if ultima_visita %}
                  <small>{{ ultima_visita.fecha_programada|date:"d/m/Y H:i" }}</small>
                {% else %}
                  <small style="color:#999;">Sin agendar</small>
                {% endif %}
              {% endwith %}
            </td>
            <td>
              {% if hogar.estado == 'pendiente_visita' %}
                <a href="{% url 'agendar_visita_tecnica' hogar.id %}" class="btn btn-primary">
                  <i class="fas fa-calendar-plus"></i> Agendar
                </a>
              {% elif hogar.estado == 'visita_agendada' %}
                {% with hogar.visitas_tecnicas.first as visita %}
                  <a href="{% url 'registrar_visita' hogar.id %}" class="btn btn-success">
                    <i class="fas fa-calendar-check"></i> Registrar Visita
                  </a>
                {% endwith %}
              {% elif hogar.estado == 'en_evaluacion' %}
                {% with hogar.visitas_tecnicas.first as visita %}
                  <a href="{% url 'ver_acta_visita' visita.acta.id %}" class="btn btn-success">
                    <i class="fas fa-eye"></i> Ver Acta
                  </a>
                {% endwith %}
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="text-align:center;padding:40px;color:#999;">
              <i class="fas fa-inbox" style="font-size:48px;margin-bottom:15px;display:block;"></i>
              No hay hogares pendientes de visita
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Paginación -->
      {% if page_obj.has_other_pages %}
      <div class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page=1">&laquo; Primera</a>
          <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
        {% endif %}
        
        <span class="current">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
          <a href="?page={{ page_obj.paginator.num_pages }}">Última &raquo;</a>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
