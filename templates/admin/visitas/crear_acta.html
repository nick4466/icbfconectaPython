{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acta de Visita Técnica V1</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Poppins",sans-serif;background:#f3f6fa;color:#333}
    .container{max-width:1200px;margin:30px auto;padding:0 20px}
    .header{background:linear-gradient(135deg,#004080,#007bff);color:white;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin-bottom:30px}
    .header h1{font-size:26px;margin-bottom:8px;display:flex;align-items:center;gap:15px}
    .header p{opacity:0.9}
    .tabs{display:flex;gap:0;background:white;border-radius:10px;overflow:hidden;margin-bottom:25px;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
    .tab{flex:1;padding:18px 20px;background:white;border:none;cursor:pointer;font-weight:600;font-size:15px;color:#666;border-bottom:3px solid transparent;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:10px}
    .tab:hover{background:#f8f9fa;color:#004080}
    .tab.active{color:#007bff;border-bottom-color:#007bff;background:#f0f8ff}
    .section{background:white;padding:30px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1);display:none}
    .section.active{display:block}
    .section-title{font-size:20px;color:#004080;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #e0e0e0;display:flex;align-items:center;gap:12px}
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:25px}
    .form-group{margin-bottom:20px}
    .form-group.full-width{grid-column:1/-1}
    .form-group label{display:block;font-weight:600;color:#333;margin-bottom:8px;font-size:14px}
    .form-group label i{margin-right:8px;color:#007bff}
    .form-group input,.form-group select,.form-group textarea{width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:8px;font-family:"Poppins",sans-serif;font-size:14px;transition:border-color .3s}
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:#007bff;outline:none}
    .form-group input[type="checkbox"]{width:auto;margin-right:8px}
    .form-group textarea{resize:vertical;min-height:80px}
    .form-group small{color:#666;font-size:12px;margin-top:5px;display:block}
    .form-group .error{color:#dc3545;font-size:13px;margin-top:5px;display:block}
    .checkbox-group{display:flex;align-items:center;gap:10px;padding:10px;background:#f8f9fa;border-radius:6px}
    .file-preview{margin-top:10px;max-width:200px;border:2px solid #e0e0e0;border-radius:8px;overflow:hidden}
    .file-preview img{width:100%;display:block}
    .subsection{background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:20px;border-left:4px solid #007bff}
    .subsection h4{color:#004080;margin-bottom:15px;font-size:16px}
    .form-actions{display:flex;gap:15px;justify-content:space-between;margin-top:30px;padding-top:25px;border-top:2px solid #e0e0e0}
    .btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;text-decoration:none;display:inline-flex;align-items:center;gap:10px;transition:all .3s}
    .btn-primary{background:#007bff;color:white}
    .btn-primary:hover{background:#0056b3;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,123,255,0.3)}
    .btn-secondary{background:#6c757d;color:white}
    .btn-secondary:hover{background:#5a6268}
    .btn-success{background:#28a745;color:white}
    .btn-success:hover{background:#218838}
    .alert{padding:15px 20px;border-radius:8px;margin-bottom:20px;display:flex;align-items:center;gap:12px}
    .alert.info{background:#d1ecf1;color:#0c5460;border-left:4px solid #0c5460}
    .alert.warning{background:#fff3cd;color:#856404;border-left:4px solid #856404}
    .auto-calc{background:#e7f3ff;padding:15px;border-radius:8px;border:2px dashed #007bff;margin-top:15px}
    .auto-calc strong{color:#004080}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-file-alt"></i> Acta de Visita Técnica V1</h1>
      <p>Hogar: <strong>{{ visita.hogar.nombre_hogar }}</strong> | Agente Educativo: <strong>{{ visita.hogar.madre.usuario.nombres }} {{ visita.hogar.madre.usuario.apellidos }}</strong></p>
      <p>Fecha Programada: <strong>{{ visita.fecha_programada|date:"d/m/Y H:i" }}</strong></p>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}warning{% else %}info{% endif %}">
          <i class="fas fa-{% if message.tags == 'error' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Tabs de Navegación -->
    <div class="tabs">
      <button class="tab active" data-section="seccion-a">
        <i class="fas fa-map-marker-alt"></i> Geolocalización
      </button>
      <button class="tab" data-section="seccion-b">
        <i class="fas fa-tools"></i> Servicios
      </button>
      <button class="tab" data-section="seccion-c">
        <i class="fas fa-ruler-combined"></i> Espacios
      </button>
      <button class="tab" data-section="seccion-d">
        <i class="fas fa-calculator"></i> Capacidad
      </button>
      <button class="tab" data-section="seccion-e">
        <i class="fas fa-check-circle"></i> Resultado
      </button>
    </div>

    <form method="post" enctype="multipart/form-data" id="actaForm">
      {% csrf_token %}

      <!-- SECCIÓN A: GEOLOCALIZACIÓN -->
      <div class="section active" id="seccion-a">
        <h2 class="section-title"><i class="fas fa-map-marked-alt"></i> A. Geolocalización y Dirección</h2>
        
        <div class="alert info">
          <i class="fas fa-info-circle"></i>
          <div>Verifique que las coordenadas GPS coincidan con la dirección registrada del hogar</div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="{{ form.latitud_verificada.id_for_label }}">
              <i class="fas fa-crosshairs"></i> Latitud GPS
            </label>
            {{ form.latitud_verificada }}
            <small>Coordenada GPS verificada en sitio</small>
            {% if form.latitud_verificada.errors %}
              {% for error in form.latitud_verificada.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.longitud_verificada.id_for_label }}">
              <i class="fas fa-crosshairs"></i> Longitud GPS
            </label>
            {{ form.longitud_verificada }}
            <small>Coordenada GPS verificada en sitio</small>
            {% if form.longitud_verificada.errors %}
              {% for error in form.longitud_verificada.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group full-width">
            <div class="checkbox-group">
              {{ form.direccion_validada }}
              <label for="{{ form.direccion_validada.id_for_label }}">
                <strong>La dirección del hogar coincide con la ubicación GPS</strong>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="{{ form.estrato_verificado.id_for_label }}">
              <i class="fas fa-layer-group"></i> Estrato Socioeconómico
            </label>
            {{ form.estrato_verificado }}
            <small>Verificado en recibo de servicios</small>
            {% if form.estrato_verificado.errors %}
              {% for error in form.estrato_verificado.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.foto_estrato.id_for_label }}">
              <i class="fas fa-camera"></i> Foto del Recibo (Estrato)
            </label>
            {{ form.foto_estrato }}
            <small>Foto clara del recibo mostrando el estrato</small>
            {% if form.foto_estrato.errors %}
              {% for error in form.foto_estrato.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- SECCIÓN B: SERVICIOS -->
      <div class="section" id="seccion-b">
        <h2 class="section-title"><i class="fas fa-tint"></i> B. Servicios Públicos e Infraestructura</h2>

        <div class="subsection">
          <h4>Servicios Disponibles</h4>
          <div class="form-grid">
            <div class="form-group">
              <div class="checkbox-group">
                {{ form.tiene_agua_potable }}
                <label for="{{ form.tiene_agua_potable.id_for_label }}">
                  <i class="fas fa-tint"></i> <strong>Agua Potable</strong>
                </label>
              </div>
            </div>

            <div class="form-group">
              <div class="checkbox-group">
                {{ form.tiene_energia_electrica }}
                <label for="{{ form.tiene_energia_electrica.id_for_label }}">
                  <i class="fas fa-bolt"></i> <strong>Energía Eléctrica</strong>
                </label>
              </div>
            </div>

            <div class="form-group">
              <div class="checkbox-group">
                {{ form.tiene_alcantarillado }}
                <label for="{{ form.tiene_alcantarillado.id_for_label }}">
                  <i class="fas fa-water"></i> <strong>Alcantarillado</strong>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="subsection">
          <h4>Estado de la Infraestructura</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="{{ form.estado_techo.id_for_label }}">
                <i class="fas fa-home"></i> Estado del Techo
              </label>
              {{ form.estado_techo }}
              {% if form.estado_techo.errors %}
                {% for error in form.estado_techo.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group">
              <label for="{{ form.estado_paredes.id_for_label }}">
                <i class="fas fa-border-all"></i> Estado de Paredes
              </label>
              {{ form.estado_paredes }}
              {% if form.estado_paredes.errors %}
                {% for error in form.estado_paredes.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group">
              <label for="{{ form.estado_pisos.id_for_label }}">
                <i class="fas fa-square"></i> Estado de Pisos
              </label>
              {{ form.estado_pisos }}
              {% if form.estado_pisos.errors %}
                {% for error in form.estado_pisos.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>

        <div class="subsection">
          <h4>Evaluación de Riesgos</h4>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="checkbox-group">
                {{ form.hay_riesgos_identificados }}
                <label for="{{ form.hay_riesgos_identificados.id_for_label }}">
                  <strong>Se identificaron riesgos en la vivienda</strong>
                </label>
              </div>
            </div>

            <div class="form-group full-width">
              <label for="{{ form.descripcion_riesgos.id_for_label }}">
                <i class="fas fa-exclamation-triangle"></i> Descripción de Riesgos
              </label>
              {{ form.descripcion_riesgos }}
              <small>Detalle los riesgos identificados (escaleras sin barandas, enchufes expuestos, etc.)</small>
              {% if form.descripcion_riesgos.errors %}
                {% for error in form.descripcion_riesgos.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN C: ESPACIOS -->
      <div class="section" id="seccion-c">
        <h2 class="section-title"><i class="fas fa-ruler"></i> C. Medición de Espacios y Fotos</h2>

        <div class="subsection">
          <h4>Área Social / Comedor</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="{{ form.area_social_largo.id_for_label }}">
                <i class="fas fa-arrows-alt-h"></i> Largo (metros)
              </label>
              {{ form.area_social_largo }}
              {% if form.area_social_largo.errors %}
                {% for error in form.area_social_largo.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group">
              <label for="{{ form.area_social_ancho.id_for_label }}">
                <i class="fas fa-arrows-alt-v"></i> Ancho (metros)
              </label>
              {{ form.area_social_ancho }}
              {% if form.area_social_ancho.errors %}
                {% for error in form.area_social_ancho.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group full-width">
              <label for="{{ form.foto_area_social.id_for_label }}">
                <i class="fas fa-camera"></i> Foto del Área Social
              </label>
              {{ form.foto_area_social }}
              <small>Foto panorámica del espacio donde estarán los niños</small>
              {% if form.foto_area_social.errors %}
                {% for error in form.foto_area_social.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>

        <div class="subsection">
          <h4>Patio / Zona de Juegos</h4>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="checkbox-group">
                {{ form.tiene_patio_cubierto }}
                <label for="{{ form.tiene_patio_cubierto.id_for_label }}">
                  <strong>El hogar cuenta con patio o zona de juegos cubierta</strong>
                </label>
              </div>
            </div>

            <div class="form-group" id="patioLargoGroup">
              <label for="{{ form.patio_largo.id_for_label }}">
                <i class="fas fa-arrows-alt-h"></i> Patio: Largo (metros)
              </label>
              {{ form.patio_largo }}
              {% if form.patio_largo.errors %}
                {% for error in form.patio_largo.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group" id="patioAnchoGroup">
              <label for="{{ form.patio_ancho.id_for_label }}">
                <i class="fas fa-arrows-alt-v"></i> Patio: Ancho (metros)
              </label>
              {{ form.patio_ancho }}
              {% if form.patio_ancho.errors %}
                {% for error in form.patio_ancho.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>

        <div class="subsection">
          <h4>Baños</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="{{ form.num_banos.id_for_label }}">
                <i class="fas fa-toilet"></i> Número de Baños
              </label>
              {{ form.num_banos }}
              {% if form.num_banos.errors %}
                {% for error in form.num_banos.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group">
              <label for="{{ form.estado_banos.id_for_label }}">
                <i class="fas fa-star"></i> Estado de los Baños
              </label>
              {{ form.estado_banos }}
              {% if form.estado_banos.errors %}
                {% for error in form.estado_banos.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>

            <div class="form-group full-width">
              <label for="{{ form.foto_banos.id_for_label }}">
                <i class="fas fa-camera"></i> Foto de los Baños
              </label>
              {{ form.foto_banos }}
              {% if form.foto_banos.errors %}
                {% for error in form.foto_banos.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>

        <div class="subsection">
          <h4>Fachada</h4>
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="{{ form.foto_fachada.id_for_label }}">
                <i class="fas fa-camera"></i> Foto de la Fachada
              </label>
              {{ form.foto_fachada }}
              <small>Foto frontal del hogar comunitario</small>
              {% if form.foto_fachada.errors %}
                {% for error in form.foto_fachada.errors %}<span class="error">{{ error }}</span>{% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN D: CAPACIDAD -->
      <div class="section" id="seccion-d">
        <h2 class="section-title"><i class="fas fa-users"></i> D. Cálculo de Capacidad</h2>

        <div class="alert info">
          <i class="fas fa-calculator"></i>
          <div>
            <strong>Cálculo Automático:</strong> El sistema calcula la capacidad basándose en 1.5 m² por niño según la normativa ICBF.
            Las áreas se calculan automáticamente a partir de las medidas ingresadas.
          </div>
        </div>

        <div class="auto-calc">
          <p><strong>Área Social:</strong> <span id="areaSocialCalc">0</span> m²</p>
          <p><strong>Área de Patio:</strong> <span id="areaPatioCalc">0</span> m²</p>
          <p><strong>Área Total Disponible:</strong> <span id="areaTotalCalc">0</span> m²</p>
          <p style="font-size:18px;margin-top:10px;color:#004080;">
            <strong>Capacidad Calculada:</strong> <span id="capacidadCalc">0</span> niños
          </p>
        </div>

        <div class="form-grid" style="margin-top:25px;">
          <div class="form-group">
            <label for="{{ form.capacidad_recomendada.id_for_label }}">
              <i class="fas fa-child"></i> Capacidad Recomendada
            </label>
            {{ form.capacidad_recomendada }}
            <small>Número máximo de niños recomendado para este hogar</small>
            {% if form.capacidad_recomendada.errors %}
              {% for error in form.capacidad_recomendada.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group full-width">
            <label for="{{ form.observaciones_capacidad.id_for_label }}">
              <i class="fas fa-comment"></i> Observaciones sobre la Capacidad
            </label>
            {{ form.observaciones_capacidad }}
            <small>Justificación si difiere del cálculo automático</small>
            {% if form.observaciones_capacidad.errors %}
              {% for error in form.observaciones_capacidad.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- SECCIÓN E: RESULTADO -->
      <div class="section" id="seccion-e">
        <h2 class="section-title"><i class="fas fa-clipboard-check"></i> E. Resultado de la Visita</h2>

        <div class="form-grid">
          <div class="form-group full-width">
            <label for="{{ form.resultado_visita.id_for_label }}">
              <i class="fas fa-gavel"></i> Decisión Final
            </label>
            {{ form.resultado_visita }}
            {% if form.resultado_visita.errors %}
              {% for error in form.resultado_visita.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group full-width" id="condicionesGroup" style="display:none;">
            <label for="{{ form.condiciones_aprobacion.id_for_label }}">
              <i class="fas fa-list-ul"></i> Condiciones para la Aprobación
            </label>
            {{ form.condiciones_aprobacion }}
            <small>Detalle las mejoras o correcciones que debe realizar el hogar</small>
            {% if form.condiciones_aprobacion.errors %}
              {% for error in form.condiciones_aprobacion.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group full-width" id="motivosRechazoGroup" style="display:none;">
            <label for="{{ form.motivos_rechazo.id_for_label }}">
              <i class="fas fa-times-circle"></i> Motivos del Rechazo
            </label>
            {{ form.motivos_rechazo }}
            <small>Explique las razones por las cuales el hogar no fue aprobado</small>
            {% if form.motivos_rechazo.errors %}
              {% for error in form.motivos_rechazo.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group full-width">
            <label for="{{ form.observaciones_generales.id_for_label }}">
              <i class="fas fa-comment-dots"></i> Observaciones Generales
            </label>
            {{ form.observaciones_generales }}
            {% if form.observaciones_generales.errors %}
              {% for error in form.observaciones_generales.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.firma_visitador.id_for_label }}">
              <i class="fas fa-signature"></i> Firma del Visitador
            </label>
            {{ form.firma_visitador }}
            <small>Imagen de la firma digital</small>
            {% if form.firma_visitador.errors %}
              {% for error in form.firma_visitador.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.firma_madre.id_for_label }}">
              <i class="fas fa-signature"></i> Firma del Agente Educativo
            </label>
            {{ form.firma_madre }}
            <small>Imagen de la firma digital</small>
            {% if form.firma_madre.errors %}
              {% for error in form.firma_madre.errors %}<span class="error">{{ error }}</span>{% endfor %}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Botones de Navegación -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnAnterior" style="display:none;">
          <i class="fas fa-arrow-left"></i> Anterior
        </button>
        <a href="{% url 'listar_hogares_pendientes_visita' %}" class="btn btn-secondary">
          <i class="fas fa-times"></i> Cancelar
        </a>
        <button type="button" class="btn btn-primary" id="btnSiguiente">
          Siguiente <i class="fas fa-arrow-right"></i>
        </button>
        <button type="submit" class="btn btn-success" id="btnGuardar" style="display:none;">
          <i class="fas fa-save"></i> Guardar Acta
        </button>
      </div>
    </form>
  </div>

  <script>
    // Navegación entre secciones
    const tabs = document.querySelectorAll('.tab');
    const sections = document.querySelectorAll('.section');
    const btnAnterior = document.getElementById('btnAnterior');
    const btnSiguiente = document.getElementById('btnSiguiente');
    const btnGuardar = document.getElementById('btnGuardar');
    let currentSection = 0;
    const sectionIds = ['seccion-a', 'seccion-b', 'seccion-c', 'seccion-d', 'seccion-e'];

    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => goToSection(index));
    });

    btnSiguiente.addEventListener('click', () => {
      if (currentSection < sectionIds.length - 1) {
        goToSection(currentSection + 1);
      }
    });

    btnAnterior.addEventListener('click', () => {
      if (currentSection > 0) {
        goToSection(currentSection - 1);
      }
    });

    function goToSection(index) {
      currentSection = index;
      
      // Actualizar tabs y secciones
      tabs.forEach(t => t.classList.remove('active'));
      sections.forEach(s => s.classList.remove('active'));
      tabs[index].classList.add('active');
      document.getElementById(sectionIds[index]).classList.add('active');
      
      // Actualizar botones
      btnAnterior.style.display = index === 0 ? 'none' : 'inline-flex';
      btnSiguiente.style.display = index === sectionIds.length - 1 ? 'none' : 'inline-flex';
      btnGuardar.style.display = index === sectionIds.length - 1 ? 'inline-flex' : 'none';
      
      // Scroll al inicio
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Mostrar/ocultar campos según patio
    const tienePatio = document.querySelector('input[name="tiene_patio_cubierto"]');
    const patioLargoGroup = document.getElementById('patioLargoGroup');
    const patioAnchoGroup = document.getElementById('patioAnchoGroup');
    
    tienePatio.addEventListener('change', function() {
      if (this.checked) {
        patioLargoGroup.style.display = 'block';
        patioAnchoGroup.style.display = 'block';
      } else {
        patioLargoGroup.style.display = 'none';
        patioAnchoGroup.style.display = 'none';
        document.querySelector('input[name="patio_largo"]').value = '';
        document.querySelector('input[name="patio_ancho"]').value = '';
      }
      calcularCapacidad();
    });

    // Mostrar/ocultar campos según resultado
    const resultadoSelect = document.querySelector('select[name="resultado_visita"]');
    const condicionesGroup = document.getElementById('condicionesGroup');
    const motivosGroup = document.getElementById('motivosRechazoGroup');
    
    resultadoSelect.addEventListener('change', function() {
      condicionesGroup.style.display = this.value === 'aprobado_condiciones' ? 'block' : 'none';
      motivosGroup.style.display = this.value === 'rechazado' ? 'block' : 'none';
    });

    // Cálculo automático de capacidad
    const areaLargo = document.querySelector('input[name="area_social_largo"]');
    const areaAncho = document.querySelector('input[name="area_social_ancho"]');
    const patioLargo = document.querySelector('input[name="patio_largo"]');
    const patioAncho = document.querySelector('input[name="patio_ancho"]');
    const capacidadInput = document.querySelector('input[name="capacidad_recomendada"]');

    [areaLargo, areaAncho, patioLargo, patioAncho].forEach(input => {
      input.addEventListener('input', calcularCapacidad);
    });

    function calcularCapacidad() {
      const largo = parseFloat(areaLargo.value) || 0;
      const ancho = parseFloat(areaAncho.value) || 0;
      const pLargo = tienePatio.checked ? (parseFloat(patioLargo.value) || 0) : 0;
      const pAncho = tienePatio.checked ? (parseFloat(patioAncho.value) || 0) : 0;
      
      const areaSocial = largo * ancho;
      const areaPatio = pLargo * pAncho;
      const areaTotal = areaSocial + areaPatio;
      const capacidad = Math.floor(areaTotal / 1.5);
      
      document.getElementById('areaSocialCalc').textContent = areaSocial.toFixed(2);
      document.getElementById('areaPatioCalc').textContent = areaPatio.toFixed(2);
      document.getElementById('areaTotalCalc').textContent = areaTotal.toFixed(2);
      document.getElementById('capacidadCalc').textContent = capacidad;
      
      if (!capacidadInput.value || capacidadInput.value == 0) {
        capacidadInput.value = capacidad;
      }
    }

    // Validación antes de enviar
    document.getElementById('actaForm').addEventListener('submit', function(e) {
      if (!confirm('¿Está seguro de guardar el acta? Esta acción cambiará el estado del hogar según el resultado de la visita.')) {
        e.preventDefault();
      }
    });

    // Cálculo inicial
    calcularCapacidad();
  </script>
</body>
</html>
