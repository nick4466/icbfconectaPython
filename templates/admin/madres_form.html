{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% if madre_form.instance.id %}Editar{% else %}Crear{% endif %} Madre
      Comunitaria
    </title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f3f6fa;
        color: #333;
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        width: 250px;
        background: linear-gradient(180deg, #004080, #007bff);
        color: white;
        display: flex;
        flex-direction: column;
        padding: 25px 0;
      }
      .sidebar img {
        height: 70px;
        margin: 0 auto 20px;
      }
      .sidebar h2 {
        text-align: center;
        font-weight: 700;
        margin-bottom: 25px;
        font-size: 18px;
      }
      .sidebar a {
        color: white;
        text-decoration: none;
        padding: 14px 25px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 500;
        transition: background 0.3s ease;
      }
      .sidebar a:hover,
      .sidebar a.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #ffffff;
      }
      /* Estilos para el menú desplegable */
      .sidebar .dropdown {
        position: relative;
      }
      .sidebar .dropdown .dropdown-menu {
        display: none;
        position: absolute;
        left: 100%;
        top: 0;
        background-color: #004080;
        min-width: 200px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 0 8px 8px 0;
      }
      .sidebar .dropdown:hover .dropdown-menu {
        display: block;
      }
      .sidebar .dropdown-menu a {
        padding: 12px 16px;
        border-left: none !important; /* Quitar borde del estado :hover o .active */
      }
      .main {
        flex: 1;
        padding: 40px;
      }
      .main header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
      }
      .main header h1 {
        font-size: 28px;
        color: #004080;
        font-weight: 700;
      }
      .content-container {
        background-color: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      }
      .required-star {
        color: #dc3545;
        margin-left: 4px;
        font-weight: bold;
      }
      .form-group {
        margin-bottom: 20px;
      }
      form label {
        font-weight: 600;
        color: #555;
        margin-bottom: 8px;
        font-size: 14px;
        display: block;
      }
      form input {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-family: "Poppins", sans-serif;
        font-size: 15px;
      }
      form input:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        outline: none;
      }
      .form-actions {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        justify-content: flex-end;
      }
      .btn-guardar,
      .btn-volver {
        padding: 10px 28px;
        border: none;
        border-radius: 6px;
        color: white;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-guardar {
        background: linear-gradient(90deg, #28a745, #218838);
      }
      .btn-volver {
        background: #6c757d;
      }
      .btn-volver:hover {
        background: #495057;
      }
      .btn-guardar:hover {
        background: #218838;
      }
      .messages {
        list-style: none;
        padding: 0;
        margin: 0 0 20px 0;
      }
      .messages li {
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 8px;
        color: white;
        font-weight: 500;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .messages li.success {
        background-color: #28a745;
      }
      .messages li.error {
        background-color: #dc3545;
      }
      .close-message {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <script>
    let currentStep = 1;

    function updateIndicators(step) {
        // Reiniciar todos a gris
        document.getElementById('step1-indicator').style.color = '#ccc';
        document.getElementById('step2-indicator').style.color = '#ccc';
        document.getElementById('step3-indicator').style.color = '#ccc';
        
        // Poner en azul el paso actual y los anteriores (indicando que ya fueron completados)
        if (step >= 1) document.getElementById('step1-indicator').style.color = '#007bff';
        if (step >= 2) document.getElementById('step2-indicator').style.color = '#007bff';
        if (step >= 3) document.getElementById('step3-indicator').style.color = '#007bff';
    }

    // Función para manejar el botón Anterior
    function prevStep(step) {
        currentStep = step - 1;
        document.getElementById(`step${step}`).style.display = 'none';
        document.getElementById(`step${currentStep}`).style.display = 'block';
        updateIndicators(currentStep);
    }
    
    // Función para manejar el botón Siguiente
    // Nota: Esta lógica SÓLO maneja el paso visual. 
    // La validación real se hará cuando se envíe el formulario completo al final.
    function nextStep(step) {
        // Opcional: Agregar aquí validación básica de JS antes de pasar al siguiente paso visual
        
        currentStep = step + 1;
        document.getElementById(`step${step}`).style.display = 'none';
        document.getElementById(`step${currentStep}`).style.display = 'block';
        updateIndicators(currentStep);
    }

    // Lógica para cerrar mensajes (si no la tienes ya)
    document.querySelectorAll('.close-message').forEach(button => {
        button.addEventListener('click', function() {
            this.closest('li').style.display = 'none';
        });
    });
    document.addEventListener('DOMContentLoaded', () => {
        const initialStep = '{{ initial_step|default:1 }}'; // Obtener el valor del contexto
        if (initialStep && initialStep !== '1') {
            // Oculta el paso 1 y muestra el paso que falló
            document.getElementById('step1').style.display = 'none';
            document.getElementById(`step${initialStep}`).style.display = 'block';
            currentStep = parseInt(initialStep);
            updateIndicators(currentStep);
        }
    });
</script>
    <!-- SIDEBAR -->
    <div class="sidebar">
      <img src="{% static 'img/logoSinFondo.png' %}" alt="Logo ICBF" />
      <h2>ICBF Conecta</h2>
      <a href="{% url 'admin_dashboard' %}"
        ><i class="fa-solid fa-tachometer-alt"></i> Inicio</a
      >
      <a href="{% url 'listar_hogares' %}"
        ><i class="fa-solid fa-house"></i> Hogares</a
      >
      <a href="{% url 'listar_madres' %}" class="active"
        ><i class="fa-solid fa-users"></i> Madres</a
      >
      <a href="{% url 'listar_administradores' %}"
        ><i class="fa-solid fa-user-shield"></i> Administradores</a
      >
      <a href="#"><i class="fa-solid fa-chart-line"></i> Reportes</a>
      <div class="dropdown">
        <a href="#"><i class="fa-solid fa-cog"></i> Ajustes</a>
        <div class="dropdown-menu">
          <a href="{% url 'editar_perfil' %}"
            ><i class="fa-solid fa-user-pen"></i> Editar Perfil</a
          >
          <a href="{% url 'cambiar_contrasena' %}"
            ><i class="fa-solid fa-key"></i> Cambiar Contraseña</a
          >
        </div>
      </div>
      <div class="logout">
        <form method="post" action="{% url 'logout' %}" style="display: inline">
          {% csrf_token %}
          <button
            type="submit"
            style="
              background: none;
              border: none;
              color: white;
              cursor: pointer;
              padding: 14px 25px;
              display: flex;
              align-items: center;
              gap: 10px;
              font-family: 'Poppins', sans-serif;
              font-size: 16px;
              font-weight: 500;
              width: 100%;
              text-align: left;
            "
          >
            <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
          </button>
        </form>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main">
      <header>
        <h1>
          {% if madre_form.instance.id %}Editar{% else %}Crear{% endif %} Madre
          Comunitaria
        </h1>
      </header>
      <form method="post" enctype="multipart/form-data" id="madreCreationForm">
        {% csrf_token %}

        <div
          style="
            display: flex;
            justify-content: space-around;
            margin-bottom: 40px;
            font-weight: 600;
          "
        >
          <span id="step1-indicator" style="color: #007bff"
            >1. Datos de Usuario</span
          >
          <span id="step2-indicator" style="color: #ccc"
            >2. Perfil de la Madre</span
          >
          <span id="step3-indicator" style="color: #ccc"
            >3. Datos del Hogar</span
          >
        </div>

        <div class="step-form" id="step1">
          <h2>Paso 1: Datos de Autenticación y Contacto</h2>
          <hr style="margin-bottom: 20px" />
          {% for field in usuario_form %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}"
              >{{ field.label }} {% if field.field.required %}<span
                class="required-star"
                >*</span
              >{% endif %}</label
            >
            {{ field }} {% for error in field.errors %}<span class="error"
              >{{ error }}</span
            >{% endfor %}
          </div>
          {% endfor %}
          <div class="form-actions">
            <button type="button" class="btn-guardar" onclick="nextStep(1)">
              Siguiente
            </button>
          </div>
        </div>

        <div class="step-form" id="step2" style="display: none">
          <h2>Paso 2: Perfil y Documentos de la Madre</h2>
          <hr style="margin-bottom: 20px" />
          {% for field in madre_profile_form %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}"
              >{{ field.label }} {% if field.field.required %}<span
                class="required-star"
                >*</span
              >{% endif %}</label
            >
            {{ field }} {% for error in field.errors %}<span class="error"
              >{{ error }}</span
            >{% endfor %}
          </div>
          {% endfor %}
          <div class="form-actions">
            <button type="button" class="btn-volver" onclick="prevStep(2)">
              Anterior
            </button>
            <button type="button" class="btn-guardar" onclick="nextStep(2)">
              Siguiente
            </button>
          </div>
        </div>

        <div class="step-form" id="step3" style="display: none">
          <h2>Paso 3: Datos del Hogar Comunitario</h2>
          <hr style="margin-bottom: 20px" />
          {% for field in hogar_form %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}"
              >{{ field.label }} {% if field.field.required %}<span
                class="required-star"
                >*</span
              >{% endif %}</label
            >
            {{ field }} {% for error in field.errors %}<span class="error"
              >{{ error }}</span
            >{% endfor %}
          </div>
          {% endfor %}
          <div class="form-actions">
            <button type="button" class="btn-volver" onclick="prevStep(3)">
              Anterior
            </button>
            <button type="submit" class="btn-guardar" id="btn-finalizar">
              Finalizar Creación
            </button>
          </div>
        </div>
      </form>
    </div>
  </body>
</html>
